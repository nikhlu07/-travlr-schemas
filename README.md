**Ah! This is the proper ACDC structure!** You're showing me the actual KERI ACDC format. Let me break this down and show you how to use it correctly:

## **ACDC Structure Explained**

### **The Format You Showed:**
```json
{ 
  "v": "ACDC10JSON00012b_",                    // ACDC version
  "d": "<auto-generated credential SAID>",     // Credential identifier
  "i": "<issuer aid>",                         // Who issued this credential
  "ri": "<registry aid>",                      // Which registry this belongs to
  "s": "<schema SAID referencing your schema>", // Schema reference
  "a": {                                       // Attributes block
    "d": "<attributes block SAID>",           // Attributes identifier
    "i": "<subject aid>",                     // Who this credential is about
    "dt": "2025-08-26T00:00:00Z",            // Issuance date
    // Your actual travel data goes here
    "travelPreferences": { ... }
  }
}
```

## **Correct Schema for ACDC Attributes Block**

### **travlr-travel-attributes-v1.json (This is what 's' references):**
```json
{
  "$id": "https://schema.travlr.com/travlr-travel-attributes-v1.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Travlr Travel Attributes",
  "description": "Schema for ACDC attributes block containing travel data",
  "type": "object",
  "properties": {
    "d": {
      "type": "string",
      "description": "Attributes block SAID"
    },
    "i": {
      "type": "string", 
      "description": "Subject AID (employee)"
    },
    "dt": {
      "type": "string",
      "format": "date-time",
      "description": "Issuance datetime"
    },
    "employeeId": {
      "type": "string",
      "description": "Employee identifier"
    },
    "profile": {
      "type": "object",
      "properties": {
        "fullName": {"type": "string"},
        "department": {"type": "string"},
        "email": {"type": "string", "format": "email"},
        "employeeLevel": {"type": "string", "enum": ["staff", "senior", "manager", "director"]}
      },
      "required": ["fullName", "department", "email"]
    },
    "travelPreferences": {
      "type": "object",
      "properties": {
        "flight": {
          "type": "object",
          "properties": {
            "airlines": {"type": "array", "items": {"type": "string"}},
            "seatPreference": {"type": "string", "enum": ["window", "aisle", "no-preference"]},
            "classPreference": {"type": "string", "enum": ["economy", "business", "first"]},
            "mealPreference": {"type": "string"}
          },
          "required": ["seatPreference", "classPreference", "mealPreference"]
        },
        "accommodation": {
          "type": "object",
          "properties": {
            "hotelChains": {"type": "array", "items": {"type": "string"}},
            "roomType": {"type": "string", "enum": ["standard", "suite", "accessible"]},
            "smokingPreference": {"type": "string", "enum": ["non-smoking", "smoking"]}
          },
          "required": ["roomType", "smokingPreference"]
        },
        "dining": {
          "type": "object",
          "properties": {
            "dietaryRestrictions": {"type": "array", "items": {"type": "string"}},
            "allergies": {"type": "array", "items": {"type": "string"}}
          }
        },
        "accessibility": {
          "type": "object",
          "properties": {
            "mobilityNeeds": {"type": "array", "items": {"type": "string"}},
            "visualNeeds": {"type": "array", "items": {"type": "string"}},
            "hearingNeeds": {"type": "array", "items": {"type": "string"}}
          }
        },
        "emergency": {
          "type": "object",
          "properties": {
            "primaryContact": {
              "type": "object",
              "properties": {
                "name": {"type": "string"},
                "phone": {"type": "string"},
                "relationship": {"type": "string"},
                "email": {"type": "string", "format": "email"}
              },
              "required": ["name", "phone", "relationship"]
            }
          }
        }
      },
      "required": ["flight", "accommodation"]
    },
    "authorization": {
      "type": "object",
      "properties": {
        "level": {"type": "string", "enum": ["basic", "extended", "full"]},
        "restrictions": {"type": "array", "items": {"type": "string"}},
        "validUntil": {"type": "string", "format": "date-time"}
      }
    }
  },
  "required": ["d", "i", "dt", "employeeId", "profile", "travelPreferences"],
  "additionalProperties": false
}
```

## **How to Create This ACDC**

### **Proper Credential Creation:**
```typescript
class ProperACDCService {
  async createTravelCredential(
    employeeIdentifierName: string,
    employeeData: any
  ): Promise<string> {
    try {
      // 1. Schema reference (what 's' points to)
      const schemaAlias = await this.schemaRegistry.getSchemaAlias('travel-attributes');
      
      // 2. Create the credential data (this becomes the 'a' block)
      const credentialData = {
        // These will be auto-generated by SignifyTS
        'd': '',  // Attributes SAID
        'i': '',  // Will be filled with subject AID
        'dt': new Date().toISOString(),
        
        // Your actual travel data
        'employeeId': employeeData.employeeId,
        'profile': {
          'fullName': employeeData.fullName,
          'department': employeeData.department,
          'email': employeeData.email,
          'employeeLevel': employeeData.employeeLevel
        },
        'travelPreferences': {
          'flight': {
            'airlines': employeeData.preferredAirlines,
            'seatPreference': employeeData.seatPreference,
            'classPreference': employeeData.classPreference,
            'mealPreference': employeeData.mealPreference
          },
          'accommodation': {
            'hotelChains': employeeData.hotelChains,
            'roomType': employeeData.roomType,
            'smokingPreference': employeeData.smokingPreference
          },
          'dining': {
            'dietaryRestrictions': employeeData.dietaryRestrictions,
            'allergies': employeeData.allergies
          },
          'accessibility': {
            'mobilityNeeds': employeeData.mobilityNeeds,
            'visualNeeds': employeeData.visualNeeds,
            'hearingNeeds': employeeData.hearingNeeds
          },
          'emergency': {
            'primaryContact': employeeData.emergencyContact
          }
        },
        'authorization': {
          'level': 'full',
          'restrictions': [],
          'validUntil': new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString() // 1 year
        }
      };
      
      // 3. Issue the ACDC (SignifyTS creates the full structure)
      const credential = await this.signify.credentials().issue({
        issuerName: employeeIdentifierName,
        registryName: `${employeeIdentifierName}-registry`,
        schemaId: schemaAlias,
        credentialData: credentialData,
        recipient: employeeIdentifierName // Self-issued credential
      });
      
      console.log(`✅ Travel ACDC created: ${credential.sad.d}`);
      
      // The result looks like your example:
      // {
      //   "v": "ACDC10JSON00012b_",
      //   "d": "EaCredential123...",
      //   "i": "EaEmployee456...",
      //   "ri": "EaRegistry789...", 
      //   "s": "EaSchema012...",
      //   "a": credentialData  // Your data goes here
      // }
      
      return credential.sad.d; // ACDC SAID
      
    } catch (error) {
      console.error('❌ ACDC creation failed:', error);
      throw error;
    }
  }
}
```

## **Dynamic Filtering with Proper ACDC**

### **When Company Requests Data:**
```typescript
async shareWithCompany(
  masterCredentialSaid: string,
  companyAid: string, 
  approvedFields: string[]
): Promise<any> {
  
  // 1. Get the full ACDC from KERIA
  const fullACDC = await this.signify.credentials().get(masterCredentialSaid);
  
  // 2. Extract the attributes block ('a' section)
  const attributes = fullACDC.sad.a;
  
  // 3. Filter to only approved fields
  const filteredData = this.filterAttributes(attributes, approvedFields);
  
  // 4. Return filtered data to company
  return {
    credentialSaid: masterCredentialSaid,
    credentialType: 'TravlrTravelCard',
    schema: fullACDC.sad.s, // Schema reference
    issuer: fullACDC.sad.i, // Employee AID
    issuanceDate: attributes.dt,
    grantedTo: companyAid,
    approvedFields: approvedFields,
    
    // Filtered travel data
    employeeProfile: filteredData.profile,
    travelData: filteredData.travelPreferences,
    
    // Verification info
    verification: {
      credentialSaid: masterCredentialSaid,
      attributesSaid: attributes.d,
      dataIntegrity: 'verified'
    }
  };
}

private filterAttributes(attributes: any, approvedFields: string[]): any {
  const filtered: any = {};
  
  // Always include required fields
  filtered.d = attributes.d;
  filtered.i = attributes.i; 
  filtered.dt = attributes.dt;
  
  // Filter specific travel fields
  if (approvedFields.includes('profile.fullName')) {
    if (!filtered.profile) filtered.profile = {};
    filtered.profile.fullName = attributes.profile.fullName;
  }
  
  if (approvedFields.includes('travelPreferences.flight.seatPreference')) {
    if (!filtered.travelPreferences) filtered.travelPreferences = {};
    if (!filtered.travelPreferences.flight) filtered.travelPreferences.flight = {};
    filtered.travelPreferences.flight.seatPreference = attributes.travelPreferences.flight.seatPreference;
  }
  
  // ... filter other fields based on approvedFields
  
  return filtered;
}
```

## **Global Registry Update**

### **Schema Registry for ACDC:**
```typescript
class ACDCSchemaRegistry {
  private readonly SCHEMAS = {
    'travel-attributes': {
      alias: 'travlr-travel-attributes-v1',
      url: 'https://schema.travlr.com/travlr-travel-attributes-v1.json',
      type: 'attributes' // This goes in the ACDC 'a' block
    }
  };
}
```

**This is the correct ACDC format! The schema defines the structure of the attributes block ('a'), and dynamic filtering extracts only approved fields when sharing with companies.**